<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MapleStory Accuracy & Hit Rate Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #f0f0f0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      transition: background 0.3s, color 0.3s;
      text-align: center;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: #333;
      border-radius: 8px;
      padding: 20px;
    }

    input, select {
      padding: 8px;
      margin: 5px 0;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    .result {
      margin-top: 20px;
      padding: 10px;
      background: #444;
      border-radius: 8px;
    }

    .light-mode {
      background: #fefefe;
      color: #222;
    }

    .light-mode .result {
      background: #ddd;
    }

    .light-mode input, .light-mode select {
      background: #fff;
      color: #000;
    }

    .toggle-container {
      margin-top: 15px;
    }

    @media (max-width: 600px) {
      input, select {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>MapleStory Accuracy & Hit Rate Calculator</h2>

    <div class="toggle-container">
      <label>
        <input type="checkbox" id="modeToggle"> Light Mode
      </label>
    </div>

    <!-- Reordered form elements -->
    <label for="monsterSelect">Select Monster:</label>
    <select id="monsterSelect">
      <option value="">-- Choose a Monster --</option>
    </select>

    <label for="bossSelect">Select Boss:</label>
    <select id="bossSelect">
      <option value="">-- Choose a Boss --</option>
    </select>

    <label>Monster Level:
      <input type="number" id="monsterLevel" value="80">
    </label>
    <label>Monster Avoid:
      <input type="number" id="avoid" value="30">
    </label>

    <label>Player Level:
      <input type="number" id="playerLevel" value="70">
    </label>
    <label>Your Accuracy:
      <input type="number" id="accuracy" value="100">
    </label>
    <label>Desired Hit Rate (%):
      <input type="number" step="1" id="desiredHitRate" value="25">
    </label>

    <div class="result" id="output"></div>
  </div>

  <script>
    const monsters = {
      Balrog: { level: 80, avoid: 30 },
      Zakum: { level: 110, avoid: 40 }
    };

    const bosses = {
      Hilla: { level: 150, avoid: 50 },
      PinkBean: { level: 160, avoid: 60 },
      VonBon: { level: 170, avoid: 55 }
    };

    const monsterSelect = document.getElementById('monsterSelect');
    const bossSelect = document.getElementById('bossSelect');
    const playerLevelInput = document.getElementById('playerLevel');
    const monsterLevelInput = document.getElementById('monsterLevel');
    const avoidInput = document.getElementById('avoid');
    const accuracyInput = document.getElementById('accuracy');
    const desiredHitRateInput = document.getElementById('desiredHitRate');
    const output = document.getElementById('output');
    const modeToggle = document.getElementById('modeToggle');

    // Populate monster dropdown
    for (const name in monsters) {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      monsterSelect.appendChild(option);
    }

    // Populate boss dropdown
    for (const name in bosses) {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      bossSelect.appendChild(option);
    }

    // Auto calculate when the monster is selected
    monsterSelect.addEventListener('change', () => {
      // Deselect boss if monster is selected
      bossSelect.selectedIndex = 0;

      const selected = monsterSelect.value;
      if (monsters[selected]) {
        monsterLevelInput.value = monsters[selected].level;
        avoidInput.value = monsters[selected].avoid;
        calculate(); // Call calculate whenever monster selection changes
      }
    });

    // Auto calculate when the boss is selected
    bossSelect.addEventListener('change', () => {
      // Deselect monster if boss is selected
      monsterSelect.selectedIndex = 0;

      const selected = bossSelect.value;
      if (bosses[selected]) {
        monsterLevelInput.value = bosses[selected].level;
        avoidInput.value = bosses[selected].avoid;
        calculate(); // Call calculate whenever boss selection changes
      }
    });

    // Deselect both monster and boss if monster level or avoid is changed
    [monsterLevelInput, avoidInput].forEach(input => {
      input.addEventListener('input', () => {
        monsterSelect.selectedIndex = 0;  // Deselect monster
        bossSelect.selectedIndex = 0;     // Deselect boss
        calculate(); // Recalculate based on the new input values
      });
    });

    // Do not deselect monster or boss when player level or accuracy is changed
    [playerLevelInput, accuracyInput, desiredHitRateInput].forEach(input => {
      input.addEventListener('input', calculate);  // Recalculate without changing selections
    });

    window.addEventListener('load', () => {
      const saved = JSON.parse(localStorage.getItem('mapleInputs'));
      if (saved) {
        playerLevelInput.value = saved.playerLevel;
        monsterLevelInput.value = saved.monsterLevel;
        avoidInput.value = saved.avoid;
        accuracyInput.value = saved.accuracy;
        desiredHitRateInput.value = saved.desiredHitRate;
      }

      if (localStorage.getItem('mode') === 'light') {
        document.body.classList.add('light-mode');
        modeToggle.checked = true;
      }

      // Auto-calculate on load to display initial result
      calculate();
    });

    modeToggle.addEventListener('change', () => {
      if (modeToggle.checked) {
        document.body.classList.add('light-mode');
        localStorage.setItem('mode', 'light');
      } else {
        document.body.classList.remove('light-mode');
        localStorage.setItem('mode', 'dark');
      }
    });

    function calculate() {
      const playerLevel = parseInt(playerLevelInput.value);
      const monsterLevel = parseInt(monsterLevelInput.value);
      const avoid = parseFloat(avoidInput.value);
      const accuracy = parseFloat(accuracyInput.value);
      const desiredHitRatePercent = parseFloat(desiredHitRateInput.value);
      const desiredHitRate = desiredHitRatePercent / 100;

      const D = Math.max(monsterLevel - playerLevel, 0);
      const factor = 1.84 + 0.07 * D;

      const requiredAccuracy = (1 + desiredHitRate) * factor * avoid;
      const actualHitRate = accuracy / (factor * avoid) - 1;
      const actualPercent = actualHitRate * 100;

      // Calculate for 100% and 1% hit rate
      const requiredAccuracy100 = (1 + 1) * factor * avoid;
      const requiredAccuracy1 = (1 + 0.01) * factor * avoid;

      // Display the result with both 1% and 100% accuracy
      output.innerHTML = `
        <strong>Results:</strong><br>
        Required Accuracy for ${desiredHitRatePercent.toFixed(2)}% hit rate: <strong>${requiredAccuracy.toFixed(2)}</strong><br>
        With ${accuracy} Accuracy, your actual hit rate is: 
        <strong>${actualPercent.toFixed(2)}%</strong><br>
        <br>
        Required Accuracy for 100% hit rate: <strong>${requiredAccuracy100.toFixed(2)}</strong><br>
        Required Accuracy for 1% hit rate: <strong>${requiredAccuracy1.toFixed(2)}</strong>
      `;

      const inputs = {
        playerLevel,
        monsterLevel,
        avoid,
        accuracy,
        desiredHitRate: desiredHitRatePercent
      };
      localStorage.setItem('mapleInputs', JSON.stringify(inputs));
    }
  </script>
</body>
</html>
