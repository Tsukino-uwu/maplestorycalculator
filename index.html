<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MapleStory Accuracy & Hit Rate Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #f0f0f0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      text-align: center;
      transition: background 0.3s, color 0.3s;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: #333;
      border-radius: 8px;
      padding: 20px;
    }

    fieldset {
      border: 1px solid #555;
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 8px;
    }

    legend {
      font-weight: bold;
      padding: 0 10px;
    }

    input, select {
      padding: 8px;
      margin: 5px 0;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    .result {
      margin-top: 20px;
      padding: 10px;
      background: #444;
      border-radius: 8px;
    }

    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }

    th, td {
      padding: 6px;
      border-bottom: 1px solid #555;
      text-align: left;
    }

    th {
      background: #555;
    }

    .highlight {
      color: #ffa500;
    }

    .toggle-container {
      margin-top: 15px;
    }

    @media (max-width: 600px) {
      .container {
        padding: 10px;
      }

      input, select {
        font-size: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>MapleStory Accuracy & Hit Rate Calculator</h2>
    
    <!-- Monster / Boss Select Panel -->
    <fieldset>
      <legend>Monster / Boss Selection</legend>
      <label for="monsterSelect">Select Monster:</label>
      <select id="monsterSelect">
        <option value="">-- Choose a Monster --</option>
      </select>

      <label for="bossSelect">Select Boss:</label>
      <select id="bossSelect">
        <option value="">-- Choose a Boss --</option>
      </select>

      <label for="monsterLevel">Monster Level: <input type="number" id="monsterLevel" value="80"></label>
      <label for="avoid">Monster Avoid: <input type="number" id="avoid" value="30"></label>
    </fieldset>
	
    <!-- Player Stats Panel -->
    <fieldset>
      <legend>Player Stats</legend>
      <label>Level: <input type="number" id="playerLevel" value="70"></label>
      <label>Accuracy: <input type="number" id="accuracy" value="100"></label>
      <label>Desired Hit Rate (%): <input type="number" step="1" id="desiredHitRate" value="25"></label>
    </fieldset>

    <div class="result" id="output"></div>
  </div>

  <script>
    const monsters = {
      Warrior2ndJobAdv: { level: 35, avoid: 10 },
      Warrior3rdJobAdv: { level: 80, avoid: 15 },
      Warrior4thJobAdv: { level: 105, avoid: 39 },
      Octopus: { level: 12, avoid: 4 },
      GreenMushroom: { level: 15, avoid: 5 },
      Bubbling: { level: 15, avoid: 10 },
      AxeStump: { level: 17, avoid: 5 },
      HornyMushroom: { level: 22, avoid: 7 },
      WoodenMask: { level: 23, avoid: 10 },
      WildBoar: { level: 25, avoid: 8 },
      FireBoar: { level: 32, avoid: 10 },
      EvilEye: { level: 27, avoid: 10 },
      BrownTeddy: { level: 30, avoid: 12 },
      PlatoonChronos: { level: 41, avoid: 22 },
      MasterChrono: { level: 46, avoid: 24 },
      Chipmunk: { level: 40, avoid: 15 },
      StrawTargetDummy: { level: 50, avoid: 15 },
      Drake: { level: 50, avoid: 18 },
      WhiteFang: { level: 58, avoid: 25 },
      MixedGolem: { level: 59, avoid: 20 },
      Nightghost: { level: 60, avoid: 25 },
      Voodoo: { level: 60, avoid: 22 },
      WildKargo: { level: 62, avoid: 20 },
      Slimy: { level: 63, avoid: 20 },
      Windraider: { level: 70, avoid: 30 },
      Homunculus: { level: 73, avoid: 28 },
      Lycanthrope: { level: 80, avoid: 28 },
      WolfSpider: { level: 80, avoid: 30 },
      DeathTeddy: { level: 85, avoid: 27 },
      DualGhostPirate: { level: 87, avoid: 28 },
      Vikerola: { level: 87, avoid: 26 },
      Gallopera: { level: 94, avoid: 37 },
      Goby: { level: 85, avoid: 29 },
      Bain: { level: 90, avoid: 38 },
      Firebrand: { level: 90, avoid: 37 },
      PhantomWatch: { level: 95, avoid: 37 },
      GrimPhantomWatch: { level: 99, avoid: 38 },
      DreamyGhost: { level: 100, avoid: 34 },
      Petrifighter: { level: 110, avoid: 38 },
      Brexton: { level: 97, avoid: 37 },
      DarkCornian: { level: 105, avoid: 45 },
      JrNewtie: { level: 105, avoid: 38 },
      Skelegon: { level: 110, avoid: 38 },
      CrimsonGuardian: { level: 120, avoid: 40 },
      ChiefMemoryGuardian: { level: 101, avoid: 37 },
      ChiefQualmGuardian: { level: 116, avoid: 40 },
      ChiefOblivionGuardian: { level: 131, avoid: 47 }
    };

    const bosses = {
      KingSlime: { level: 40, avoid: 10 },
      Alishar: { level: 56, avoid: 26 },
      KingClang: { level: 55, avoid: 20 },
      Mushmom: { level: 60, avoid: 27 },
      JrBalrog: { level: 80, avoid: 30 },
      CrimsonBalrog: { level: 100, avoid: 40 },
      Snowman: { level: 90, avoid: 38 },
      HeadlessHorseman: { level: 101, avoid: 42 },
      Bigfoot: { level: 110, avoid: 37 },
      MaleBoss: { level: 95, avoid: 35 },
      FemaleBoss: { level: 130, avoid: 43 },
      TheBoss: { level: 175, avoid: 60 },
      ManonAndGriffey: { level: 105, avoid: 39 },
      Pianus: { level: 110, avoid: 14 },
      BlackCrow: { level: 115, avoid: 39 },
      KacchuuMusha: { level: 120, avoid: 42 },
      Leviathan: { level: 120, avoid: 41 },
      CWKPQ: { level: 130, avoid: 55 },
      Dodo: { level: 121, avoid: 42 },
      Lilynouch: { level: 131, avoid: 47 },
      Lyka: { level: 141, avoid: 49 },
      PapulatusClock: { level: 125, avoid: 12 },
      PapulatusBody: { level: 125, avoid: 40 },
      Krexel: { level: 140, avoid: 20 },
      ScarlionAndTarga: { level: 140, avoid: 20 },
      Zakum3: { level: 140, avoid: 16 },
      Horntail: { level: 160, avoid: 45 },
      Castellan: { level: 180, avoid: 45 },
      Pinkbean: { level: 180, avoid: 55 }
    };

    const monsterSelect = document.getElementById('monsterSelect');
    const bossSelect = document.getElementById('bossSelect');
    const playerLevelInput = document.getElementById('playerLevel');
    const monsterLevelInput = document.getElementById('monsterLevel');
    const avoidInput = document.getElementById('avoid');
    const accuracyInput = document.getElementById('accuracy');
    const desiredHitRateInput = document.getElementById('desiredHitRate');
    const output = document.getElementById('output');

    for (const name in monsters) {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      monsterSelect.appendChild(option);
    }

    for (const name in bosses) {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      bossSelect.appendChild(option);
    }

    monsterSelect.addEventListener('change', () => {
      bossSelect.selectedIndex = 0;
      const selected = monsterSelect.value;
      if (monsters[selected]) {
        monsterLevelInput.value = monsters[selected].level;
        avoidInput.value = monsters[selected].avoid;
        calculate();
      }
    });

    bossSelect.addEventListener('change', () => {
      monsterSelect.selectedIndex = 0;
      const selected = bossSelect.value;
      if (bosses[selected]) {
        monsterLevelInput.value = bosses[selected].level;
        avoidInput.value = bosses[selected].avoid;
        calculate();
      }
    });

    [monsterLevelInput, avoidInput].forEach(input => {
      input.addEventListener('input', () => {
        monsterSelect.selectedIndex = 0;
        bossSelect.selectedIndex = 0;
        calculate();
      });
    });

    [playerLevelInput, accuracyInput, desiredHitRateInput].forEach(input => {
      input.addEventListener('input', calculate);
    });

    window.addEventListener('load', () => {
      const saved = JSON.parse(localStorage.getItem('mapleInputs'));
      if (saved) {
        playerLevelInput.value = saved.playerLevel;
        monsterLevelInput.value = saved.monsterLevel;
        avoidInput.value = saved.avoid;
        accuracyInput.value = saved.accuracy;
        desiredHitRateInput.value = saved.desiredHitRate;
      }

      calculate();
    });

    function calculate() {
      const playerLevel = parseInt(playerLevelInput.value);
      const monsterLevel = parseInt(monsterLevelInput.value);
      const avoid = parseFloat(avoidInput.value);
      const accuracy = parseFloat(accuracyInput.value);
      const desiredHitRatePercent = parseFloat(desiredHitRateInput.value);
      const desiredHitRate = desiredHitRatePercent / 100;

      const D = Math.max(monsterLevel - playerLevel, 0);
      const factor = 1.84 + 0.07 * D;

      const requiredAccuracy = (1 + desiredHitRate) * factor * avoid;
      const actualHitRate = accuracy / (factor * avoid) - 1;
      const actualPercent = actualHitRate * 100;

      const thresholds = [
        { label: "1%", rate: 0.01 },
        { label: `${desiredHitRatePercent}%`, rate: desiredHitRate },
        { label: "100%", rate: 1 }
      ];

      let tableRows = "";
      for (const threshold of thresholds) {
        const reqAcc = (1 + threshold.rate) * factor * avoid;
        const extraAcc = Math.max(reqAcc - accuracy, 0);
        const dexNeeded = extraAcc / 0.8;

        tableRows += `
          <tr>
            <td>${threshold.label}</td>
            <td>${Math.ceil(reqAcc)}</td> <!-- Round up and remove .00 -->
            <td class="${extraAcc > 0 ? 'highlight' : ''}">${Math.ceil(extraAcc)}</td> <!-- Round up and remove .00 -->
            <td class="${extraAcc > 0 ? 'highlight' : ''}">${Math.ceil(dexNeeded)}</td> <!-- Round up and remove .00 -->
          </tr>
        `;
      }

      output.innerHTML = `
        <strong>Current Accuracy:</strong> ${accuracy}<br>
        <strong>Current Hit Rate:</strong> <span class="highlight">${actualPercent.toFixed(2)}%</span><br><br>
        <table>
          <thead>
            <tr>
              <th>Hit Rate</th>
              <th>Req. Acc</th>
              <th>Acc Needed</th>
              <th>DEX Needed</th>
            </tr>
          </thead>
          <tbody>
            ${tableRows}
          </tbody>
        </table>
      `;

      const inputs = {
        playerLevel,
        monsterLevel,
        avoid,
        accuracy,
        desiredHitRate: desiredHitRatePercent
      };
      localStorage.setItem('mapleInputs', JSON.stringify(inputs));
    }
  </script>
</body>
</html>
