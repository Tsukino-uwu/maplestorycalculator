<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MapleStory Accuracy & Hit Rate Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #1a1a1a;
      color: #f0f0f0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      transition: background 0.3s, color 0.3s;
      text-align: center;
    }

    .container {
      max-width: 600px;
      width: 100%;
      background: #333;
      border-radius: 8px;
      padding: 20px;
    }

    input, select {
      padding: 8px;
      margin: 5px 0;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    .result {
      margin-top: 20px;
      padding: 10px;
      background: #444;
      border-radius: 8px;
    }

    .light-mode {
      background: #fefefe;
      color: #222;
    }

    .light-mode .result {
      background: #ddd;
    }

    .light-mode input, .light-mode select {
      background: #fff;
      color: #000;
    }

    .toggle-container {
      margin-top: 15px;
    }

    @media (max-width: 600px) {
      input, select {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>MapleStory Accuracy & Hit Rate Calculator</h2>

    <div class="toggle-container">
      <label>
        <input type="checkbox" id="modeToggle"> Light Mode
      </label>
    </div>

    <!-- Reordered form elements -->
    <label for="monsterSelect">Select Monster:</label>
    <select id="monsterSelect">
      <option value="">-- Choose a Monster --</option>
    </select>

    <label for="bossSelect">Select Boss:</label>
    <select id="bossSelect">
      <option value="">-- Choose a Boss --</option>
    </select>

    <label>Monster Level:
      <input type="number" id="monsterLevel" value="80">
    </label>
    <label>Monster Avoid:
      <input type="number" id="avoid" value="30">
    </label>

    <label>Player Level:
      <input type="number" id="playerLevel" value="70">
    </label>
    <label>Your Accuracy:
      <input type="number" id="accuracy" value="100">
    </label>
    <label>Desired Hit Rate (%):
      <input type="number" step="1" id="desiredHitRate" value="25">
    </label>

    <div class="result" id="output"></div>
  </div>

  <script>
    const monsters = {
      Warrior2ndJobAdv: { level: 35, avoid: 10 },
      Warrior3rdJobAdv: { level: 80, avoid: 15 },
      Warrior4thJobAdv: { level: 105, avoid: 39 },
      Octopus: { level: 12, avoid: 4 },
      GreenMushroom: { level: 15, avoid: 5 },
      Bubbling: { level: 15, avoid: 10 },
      AxeStump: { level: 17, avoid: 5 },
      HornyMushroom: { level: 22, avoid: 7 },
      WoodenMask: { level: 23, avoid: 10 },
      WildBoar: { level: 25, avoid: 8 },
      FireBoar: { level: 32, avoid: 10 },
      EvilEye: { level: 27, avoid: 10 },
      BrownTeddy: { level: 30, avoid: 12 },
      PlatoonChronos: { level: 41, avoid: 22 },
      MasterChrono: { level: 46, avoid: 24 },
      Chipmunk: { level: 40, avoid: 15 },
      StrawTargetDummy: { level: 50, avoid: 15 },
      Drake: { level: 50, avoid: 18 },
      WhiteFang: { level: 58, avoid: 25 },
      MixedGolem: { level: 59, avoid: 20 },
      Nightghost: { level: 60, avoid: 25 },
      Voodoo: { level: 60, avoid: 22 },
      WildKargo: { level: 62, avoid: 20 },
      Slimy: { level: 63, avoid: 20 },
      Windraider: { level: 70, avoid: 30 },
      Homunculus: { level: 73, avoid: 28 },
      Lycanthrope: { level: 80, avoid: 28 },
      WolfSpider: { level: 80, avoid: 30 },
      DeathTeddy: { level: 85, avoid: 27 },
      DualGhostPirate: { level: 87, avoid: 28 },
      Vikerola: { level: 87, avoid: 26 },
      Gallopera: { level: 94, avoid: 37 },
      Goby: { level: 85, avoid: 29 },
      Bain: { level: 90, avoid: 38 },
      Firebrand: { level: 90, avoid: 37 },
      PhantomWatch: { level: 95, avoid: 37 },
      GrimPhantomWatch: { level: 99, avoid: 38 },
      DreamyGhost: { level: 100, avoid: 34 },
      Petrifighter: { level: 110, avoid: 38 },
      Brexton: { level: 97, avoid: 37 },
      DarkCornian: { level: 105, avoid: 45 },
      JrNewtie: { level: 105, avoid: 38 },
      Skelegon: { level: 110, avoid: 38 },
      CrimsonGuardian: { level: 120, avoid: 40 },
      ChiefMemoryGuardian: { level: 101, avoid: 37 },
      ChiefQualmGuardian: { level: 116, avoid: 40 },
      ChiefOblivionGuardian: { level: 131, avoid: 47 }
    };

    const bosses = {
      KingSlime: { level: 40, avoid: 10 },
      Alishar: { level: 45, avoid: 26 },
      KingClang: { level: 55, avoid: 20 },
      Mushmom: { level: 60, avoid: 27 },
      JrBalrog: { level: 80, avoid: 30 },
      CrimsonBalrog: { level: 100, avoid: 40 },
      Snowman: { level: 90, avoid: 38 },
      HeadlessHorseman: { level: 101, avoid: 42 },
      Bigfoot: { level: 110, avoid: 37 },
      MaleBoss: { level: 95, avoid: 35 },
      FemaleBoss: { level: 130, avoid: 43 },
      TheBoss: { level: 175, avoid: 60 },
      ManonAndGriffey: { level: 105, avoid: 39 },
      Pianus: { level: 110, avoid: 14 },
      BlackCrow: { level: 115, avoid: 39 },
      KacchuuMusha: { level: 120, avoid: 42 },
      Leviathan: { level: 120, avoid: 41 },
      CWKPQ: { level: 130, avoid: 55 },
      Dodo: { level: 121, avoid: 42 },
      Lilynouch: { level: 131, avoid: 47 },
      Lyka: { level: 141, avoid: 49 },
      PapulatusClock: { level: 125, avoid: 12 },
      PapulatusBody: { level: 125, avoid: 40 },
      Krexel: { level: 140, avoid: 20 },
      ScarlionAndTarga: { level: 140, avoid: 20 },
      Zakum3: { level: 140, avoid: 16 },
      Horntail: { level: 160, avoid: 45 },
      Castellan: { level: 180, avoid: 45 },
      Pinkbean: { level: 180, avoid: 55 }
    };

    const monsterSelect = document.getElementById('monsterSelect');
    const bossSelect = document.getElementById('bossSelect');
    const playerLevelInput = document.getElementById('playerLevel');
    const monsterLevelInput = document.getElementById('monsterLevel');
    const avoidInput = document.getElementById('avoid');
    const accuracyInput = document.getElementById('accuracy');
    const desiredHitRateInput = document.getElementById('desiredHitRate');
    const output = document.getElementById('output');
    const modeToggle = document.getElementById('modeToggle');

    // Populate monster dropdown
    for (const name in monsters) {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      monsterSelect.appendChild(option);
    }

    // Populate boss dropdown
    for (const name in bosses) {
      const option = document.createElement('option');
      option.value = name;
      option.textContent = name;
      bossSelect.appendChild(option);
    }

    // Auto calculate when the monster is selected
    monsterSelect.addEventListener('change', () => {
      // Deselect boss if monster is selected
      bossSelect.selectedIndex = 0;

      const selected = monsterSelect.value;
      if (monsters[selected]) {
        monsterLevelInput.value = monsters[selected].level;
        avoidInput.value = monsters[selected].avoid;
        calculate(); // Call calculate whenever monster selection changes
      }
    });

    // Auto calculate when the boss is selected
    bossSelect.addEventListener('change', () => {
      // Deselect monster if boss is selected
      monsterSelect.selectedIndex = 0;

      const selected = bossSelect.value;
      if (bosses[selected]) {
        monsterLevelInput.value = bosses[selected].level;
        avoidInput.value = bosses[selected].avoid;
        calculate(); // Call calculate whenever boss selection changes
      }
    });

    // Deselect both monster and boss if monster level or avoid is changed
    [monsterLevelInput, avoidInput].forEach(input => {
      input.addEventListener('input', () => {
        monsterSelect.selectedIndex = 0;  // Deselect monster
        bossSelect.selectedIndex = 0;     // Deselect boss
        calculate(); // Recalculate based on the new input values
      });
    });

    // Do not deselect monster or boss when player level or accuracy is changed
    [playerLevelInput, accuracyInput, desiredHitRateInput].forEach(input => {
      input.addEventListener('input', calculate);  // Recalculate without changing selections
    });

    window.addEventListener('load', () => {
      const saved = JSON.parse(localStorage.getItem('mapleInputs'));
      if (saved) {
        playerLevelInput.value = saved.playerLevel;
        monsterLevelInput.value = saved.monsterLevel;
        avoidInput.value = saved.avoid;
        accuracyInput.value = saved.accuracy;
        desiredHitRateInput.value = saved.desiredHitRate;
      }

      if (localStorage.getItem('mode') === 'light') {
        document.body.classList.add('light-mode');
        modeToggle.checked = true;
      }

      // Auto-calculate on load to display initial result
      calculate();
    });

    modeToggle.addEventListener('change', () => {
      if (modeToggle.checked) {
        document.body.classList.add('light-mode');
        localStorage.setItem('mode', 'light');
      } else {
        document.body.classList.remove('light-mode');
        localStorage.setItem('mode', 'dark');
      }
    });

    function calculate() {
      const playerLevel = parseInt(playerLevelInput.value);
      const monsterLevel = parseInt(monsterLevelInput.value);
      const avoid = parseFloat(avoidInput.value);
      const accuracy = parseFloat(accuracyInput.value);
      const desiredHitRatePercent = parseFloat(desiredHitRateInput.value);
      const desiredHitRate = desiredHitRatePercent / 100;

      const D = Math.max(monsterLevel - playerLevel, 0);
      const factor = 1.84 + 0.07 * D;

      const requiredAccuracy = (1 + desiredHitRate) * factor * avoid;
      const actualHitRate = accuracy / (factor * avoid) - 1;
      const actualPercent = actualHitRate * 100;

      // Calculate for 100% and 1% hit rate
      const requiredAccuracy100 = (1 + 1) * factor * avoid;
      const requiredAccuracy1 = (1 + 0.01) * factor * avoid;

      // Display the result with both 1% and 100% accuracy
      output.innerHTML = `
        <strong>Results:</strong><br>
        Required Accuracy for ${desiredHitRatePercent.toFixed(2)}% hit rate: <strong>${requiredAccuracy.toFixed(2)}</strong><br>
        With ${accuracy} Accuracy, your actual hit rate is: 
        <strong>${actualPercent.toFixed(2)}%</strong><br>
        <br>
        Required Accuracy for 100% hit rate: <strong>${requiredAccuracy100.toFixed(2)}</strong><br>
        Required Accuracy for 1% hit rate: <strong>${requiredAccuracy1.toFixed(2)}</strong>
      `;

      const inputs = {
        playerLevel,
        monsterLevel,
        avoid,
        accuracy,
        desiredHitRate: desiredHitRatePercent
      };
      localStorage.setItem('mapleInputs', JSON.stringify(inputs));
    }
  </script>
</body>
</html>
